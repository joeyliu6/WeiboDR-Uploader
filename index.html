<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="/src/style.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WeiboDR-Uploader (微博灾备上传器)</title>
  </head>
  <body>
    <div class="dashboard-container">
      <div class="sidebar">
        <button id="nav-upload" class="nav-btn active">☁️</button>
        <button id="nav-history" class="nav-btn">📜</button>
        <button id="nav-failed" class="nav-btn">⚠️<span class="badge" id="badge" style="display: none;">0</span></button>
        <button id="nav-settings" class="nav-btn">⚙️</button>
      </div>
      <div class="content-area">
        <div id="upload-view" class="view active">
          <div class="upload-container">
            <!-- 顶部拖拽区域 -->
            <div id="drop-zone-header">
              <div id="drop-message">
                <p>📤 拖拽图片到此处上传</p>
                <span>或点击选择文件</span>
              </div>
              <input type="file" id="file-input" multiple accept="image/*" style="display: none;" />
            </div>
            
            <!-- R2 备份开关 -->
            <div class="upload-controls">
              <label class="r2-toggle">
                <input type="checkbox" id="upload-view-toggle-r2" checked />
                <span>同时备份到 Cloudflare R2</span>
              </label>
            </div>
            
            <!-- 上传队列列表 -->
            <div id="upload-queue-container">
              <h3>上传队列</h3>
              <div id="upload-queue-list"></div>
            </div>
          </div>
        </div>
        <div id="history-view" class="view">
          <div class="container">
            <h1>上传历史记录</h1>
            
            <!-- v-1.2 新增：搜索框 -->
            <div class="search-section">
                <input type="text" id="search-input" placeholder="搜索本地文件名..." />
            </div>
            
            <table id="history-table">
                <thead>
                    <tr>
                        <th>预览</th>
                        <th>本地文件名</th>
                        <th>生成链接</th>
                        <th>上传时间</th>
                        <th>操作</th>
                        <th>删除</th>
                    </tr>
                </thead>
                <tbody id="history-body">
                </tbody>
            </table>
    
            <div class="footer">
                <button id="export-json-btn">导出为 JSON</button>
                <button id="sync-webdav-btn">立即同步到 WebDAV</button>
                <button id="clear-history-btn">清空历史</button>
                <span id="status-message"></span>
            </div>
        </div>
        </div>
        <div id="settings-view" class="view">
          <div class="container">
            <h1>设置</h1>
    
            <div class="form-section">
                <h2>微博 Cookie (必填)</h2>
                <p>用于 m.weibo.cn 接口。这是项目成功的关键。</p>
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <button id="login-with-webview-btn" style="flex: 1; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">🌐 自动获取Cookie</button>
                    <button id="test-cookie-btn" style="flex: 1;">测试连接</button>
                </div>
                <textarea id="weibo-cookie" rows="5" placeholder="在此粘贴从 m.weibo.cn 获取的完整 Cookie 字符串...或点击上方'自动获取Cookie'按钮"></textarea>
                <span id="cookie-status"></span>
            </div>
    
            <div class="form-section">
                <h2>Cloudflare R2 备份 (可选)</h2>
                <p>步骤 A 成功后，将图片异步备份到 R2。</p>
                <label>R2 账户 ID (Account ID)</label>
                <input type="text" id="r2-account-id" />
    
                <label>R2 访问密钥 ID (Access Key ID)</label>
                <input type="password" id="r2-key-id" />
    
                <label>R2 访问密钥 (Secret Access Key)</label>
                <input type="password" id="r2-secret-key" />
    
                <label>R2 存储桶名称 (Bucket Name)</label>
                <input type="text" id="r2-bucket" />
    
                <label>R2 自定义路径 (Optional Path)</label>
                <input type="text" id="r2-path" placeholder="例如: blog/images/ (留空则为根目录)" />
    
                <label>R2 公开访问域名 (Public Domain)</label>
                <input type="text" id="r2-public-domain" placeholder="例如: https://images.example.com (末尾不要加 /)" />
                
                <button type="button" id="test-r2-btn">测试 R2 连接</button>
                <span id="r2-status-message"></span>
            </div>
    
            <div class="form-section">
                <h2>输出格式 (PRD 3.2)</h2>
                <label>百度代理前缀</label>
                <input type="text" id="baidu-prefix" value="https://image.baidu.com/search/down?thumburl=" />
                
                <label>链接格式选项</label>
                <div class="radio-group">
                    <input type="radio" id="format-baidu" name="output-format" value="baidu" checked>
                    <label for="format-baidu">百度代理链接 (用于发布)</label>
                </div>
                <div class="radio-group">
                    <input type="radio" id="format-weibo" name="output-format" value="weibo">
                    <label for="format-weibo">large 微博原始链接 (用于调试)</label>
                </div>
                <div class="radio-group">
                    <input type="radio" id="format-r2" name="output-format" value="r2">
                    <label for="format-r2">R2 公开访问链接 (用于切换灾备)</label>
                </div>
            </div>
    
            <div class="form-section">
                <h2>WebDAV 自动备份 (可选) (v1.2)</h2>
                <p>配置后，每次上传成功会自动将历史记录同步到 WebDAV（例如：坚果云）。</p>
                <label>WebDAV URL</label>
                <input type="text" id="webdav-url" placeholder="例如: https://dav.jianguoyun.com/dav/" />
                
                <label>WebDAV 用户名</label>
                <input type="text" id="webdav-username" placeholder="通常是邮箱" />
                
                <label>WebDAV 密码</label>
                <input type="password" id="webdav-password" placeholder="通常是应用的授权码" />
                
                <label>远程路径</label>
                <input type="text" id="webdav-remote-path" placeholder="例如: /WeiboDR/history.json" value="/WeiboDR/history.json" />
                
                <button type="button" id="test-webdav-btn">测试 WebDAV 连接</button>
                <span id="webdav-status-message"></span>
            </div>
    
            <div class="footer">
                <span id="save-status"></span>
            </div>
        </div>
        </div>
        <div id="failed-view" class="view">
          <div class="container">
            <h1>失败队列</h1>
            
            <div class="footer" style="margin-bottom: 20px;">
                <button id="retry-all-btn">全部重试</button>
                <button id="clear-all-failed-btn">全部清除</button>
            </div>
            
            <table id="failed-table">
                <thead>
                    <tr>
                        <th>本地文件名</th>
                        <th>失败原因</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="failed-body">
                </tbody>
            </table>
        </div>
        </div>
      </div>
    </div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>

