# 微博账号密码登录功能使用指南

## 功能概述

现在你的应用支持通过微博账号密码自动登录并获取Cookie！不再需要手动从浏览器复制Cookie。

## 使用方法

### 方式一：通过设置页面登录（推荐）

1. **打开应用**，点击右下角的 ⚙️ 设置按钮
2. 在"微博 Cookie"部分，点击 **🔐 使用账号密码登录** 按钮
3. 在弹出的登录窗口中：
   - 输入微博用户名（手机号或邮箱）
   - 输入密码
   - 点击"立即登录"
4. 登录成功后：
   - Cookie会自动填充到设置页面
   - Cookie会自动保存
   - 登录窗口会自动关闭
5. 完成！现在你可以开始上传图片了

### 方式二：启用自动续期（推荐长期使用）

如果你担心Cookie过期，可以启用自动续期功能：

1. 在设置页面的"高级选项"部分
2. 勾选 **"启用账号密码自动续期"**
3. 输入微博用户名和密码
4. 点击"保存配置"
5. 当Cookie过期时，程序会自动使用你保存的账号密码重新登录

## 功能特点

### ✅ 安全性
- 账号密码和Cookie都存储在本地
- 不会上传到任何服务器
- 使用Tauri的加密存储机制

### ✅ 便捷性
- 一键登录，无需手动复制Cookie
- 支持自动续期，无需反复登录
- 登录窗口简洁美观

### ✅ 智能化
- 自动检测Cookie是否过期
- Cookie过期时自动重新登录（如果启用了自动续期）
- 详细的错误提示和日志

## 常见问题

### Q: 登录失败怎么办？

**A:** 可能的原因：
1. **用户名或密码错误** - 请检查账号密码是否正确
2. **需要验证码** - 微博检测到异常登录，请稍后重试或使用手动填写Cookie的方式
3. **网络问题** - 请检查网络连接
4. **账号异常** - 账号可能被限制，需要前往微博官网解除

### Q: Cookie会过期吗？

**A:** 是的，Cookie通常会在一段时间后过期。建议启用"自动续期"功能，程序会在Cookie过期时自动重新登录。

### Q: 为什么要启用自动续期？

**A:** 
- Cookie通常会在几天到几周后过期
- 启用自动续期后，程序会在检测到Cookie过期时自动使用你保存的账号密码重新登录
- 这样你就不需要反复手动登录了

### Q: 如果遇到验证码怎么办？

**A:** 
- 微博有时会要求验证码验证
- 如果遇到验证码，可以：
  1. 稍后再试（等待一段时间后微博可能不再要求验证码）
  2. 使用传统方式手动从浏览器复制Cookie

### Q: 账号密码存储安全吗？

**A:** 
- 是的，账号密码存储在本地，使用Tauri的Store加密存储
- 不会上传到任何服务器
- 只有你的电脑可以访问

## 技术实现

### 登录流程

```
用户输入账号密码
    ↓
前端发送到Rust后端
    ↓
后端调用微博登录API
    ↓
获取Cookie
    ↓
发送Cookie到主窗口
    ↓
保存到本地存储
    ↓
完成
```

### 自动续期流程

```
上传图片时检测到Cookie过期
    ↓
读取保存的账号密码
    ↓
自动调用登录接口
    ↓
更新Cookie
    ↓
重试上传
```

## 代码结构

### 前端文件
- `login.html` - 登录窗口页面
- `src/login.ts` - 登录窗口逻辑
- `src/main.ts` - 主窗口集成和Cookie监听

### 后端文件
- `src-tauri/src/main.rs` - Rust后端登录实现
  - `attempt_weibo_login` - 登录命令
  - `save_cookie_from_login` - 保存Cookie命令

## 更新日志

### v1.3.0 (2025-11-17)
- ✅ 新增微博账号密码登录功能
- ✅ 新增登录窗口UI
- ✅ 新增Cookie自动更新机制
- ✅ 集成到设置页面
- ✅ 支持自动续期功能

## 下一步开发建议

1. **二维码登录** - 添加扫码登录支持
2. **多账号管理** - 支持保存多个微博账号
3. **登录历史** - 记录登录历史和状态
4. **Cookie有效期提醒** - 提前提醒用户Cookie即将过期

## 贡献

如果你在使用过程中遇到问题或有改进建议，欢迎：
- 提交Issue
- 提交Pull Request
- 在讨论区交流

## 致谢

本功能参考了 [Weibo-Picture-Store](https://github.com/Semibold/Weibo-Picture-Store) 项目的实现思路。
