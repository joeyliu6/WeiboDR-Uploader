<script setup lang="ts">
import { computed } from 'vue';
import type { ServiceStatus, CloudServiceType, ConnectionStatus } from '../types';

const props = defineProps<{
  /** 服务状态列表 */
  services: ServiceStatus[];
  /** 当前激活的服务 */
  activeService: CloudServiceType;
}>();

const emit = defineEmits<{
  change: [serviceId: CloudServiceType];
}>();

// 服务 SVG 图标
const serviceIcons: Record<string, string> = {
  r2: '<svg viewBox="0 0 1280 1024" xmlns="http://www.w3.org/2000/svg"><path d="M796.82375 631.836875l-432.75-5.49a8.5875 8.5875 0 0 1-6.81-3.61125 8.715 8.715 0 0 1-0.92625-7.775625 11.518125 11.518125 0 0 1 10.051875-7.6425l436.7625-5.505c51.808125-2.3625 107.89875-44.20125 127.54125-95.22l24.91125-64.76625a14.895 14.895 0 0 0 0.9825-5.505 14.503125 14.503125 0 0 0-0.3075-3.058125A284.83125 284.83125 0 0 0 409.356875 404 127.725 127.725 0 0 0 208.625 537.48125C110.6075 540.32375 32 620.24 32 718.475a180.10125 180.10125 0 0 0 1.929375 26.17125 8.4525 8.4525 0 0 0 8.334375 7.258125l798.9375 0.095625c0.080625 0 0.15-0.035625 0.22875-0.0375a10.51125 10.51125 0 0 0 9.883125-7.5l6.136875-21.121875c7.3125-25.125 4.59-48.375-7.6875-65.4375-11.28-15.735-30.09375-24.99-52.93875-26.06625z m198.65625-185.274375c-4.014375 0-8.008125 0.11625-11.983125 0.3075a7.070625 7.070625 0 0 0-6.2325 4.974375l-17.019375 58.486875c-7.3125 25.125-4.591875 48.34875 7.6875 65.41875 11.2875 15.75 30.10125 24.980625 52.94625 26.0625l92.25 5.510625a8.420625 8.420625 0 0 1 6.58125 3.55125 8.7 8.7 0 0 1 0.96375 7.816875 11.536875 11.536875 0 0 1-10.033125 7.640625l-95.859375 5.510625c-52.03875 2.38125-108.129375 44.20125-127.771875 95.22l-6.928125 18.01125a5.0925 5.0925 0 0 0 4.550625 6.9c0.08625 0 0.165 0.031875 0.255 0.031875h329.83125a8.79375 8.79375 0 0 0 8.510625-6.31875 234.013125 234.013125 0 0 0 8.77875-63.75C1232 551.9375 1126.1075 446.5625 995.48 446.5625z" fill="currentColor"></path></svg>',
  cos: '<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M753.066667 516.266667c-12.8-17.066667-27.733333-23.466667-51.2-29.866667-6.4-2.133333-27.733333-2.133333-32-2.133333 0 0-6.4 2.133333-10.666667 4.266666-6.4 2.133333-10.666667 4.266667-17.066667 6.4-8.533333 4.266667-25.6 17.066667-27.733333 19.2-2.133333 2.133333-4.266667 6.4-8.533333 8.533334-8.533333 6.4-59.733333 57.6-74.666667 70.4l-38.4 38.4c-17.066667 17.066667-29.866667 29.866667-29.866667 32 0 2.133333 194.133333 2.133333 217.6 0 8.533333 0 17.066667-2.133333 25.6-2.133334 17.066667-4.266667 34.133333-14.933333 46.933334-32 6.4-8.533333 10.666667-17.066667 14.933333-29.866666 2.133333-8.533333 4.266667-12.8 2.133333-27.733334 2.133333-23.466667-4.266667-38.4-17.066666-55.466666zM832 106.666667H192C145.066667 106.666667 106.666667 145.066667 106.666667 192v640c0 46.933333 38.4 85.333333 85.333333 85.333333h640c46.933333 0 85.333333-38.4 85.333333-85.333333V192c0-46.933333-38.4-85.333333-85.333333-85.333333z m-53.333333 580.266666c-10.666667 8.533333-23.466667 17.066667-29.866667 19.2-2.133333 0-4.266667 2.133333-6.4 2.133334-2.133333 2.133333-23.466667 6.4-36.266667 10.666666-10.666667 2.133333-27.733333 2.133333-194.133333 2.133334-198.4 0-189.866667 0-215.466667-6.4-21.333333-6.4-42.666667-19.2-59.733333-36.266667-29.866667-27.733333-42.666667-64-42.666667-104.533333 0-14.933333 2.133333-29.866667 6.4-44.8 6.4-17.066667 8.533333-23.466667 27.733334-49.066667 4.266667-4.266667 23.466667-21.333333 29.866666-27.733333 10.666667-6.4 44.8-21.333333 51.2-21.333334 4.266667 0 6.4-4.266667 8.533334-10.666666 6.4-21.333333 8.533333-25.6 12.8-40.533334 10.666667-25.6 29.866667-51.2 53.333333-70.4 4.266667-4.266667 8.533333-6.4 12.8-10.666666 2.133333-2.133333 4.266667-2.133333 6.4-4.266667 17.066667-12.8 53.333333-27.733333 78.933333-29.866667 27.733333-4.266667 59.733333-2.133333 81.066667 6.4 17.066667 4.266667 21.333333 6.4 23.466667 8.533334 4.266667 2.133333 10.666667 4.266667 14.933333 6.4 19.2 8.533333 42.666667 27.733333 55.466667 42.666666 10.666667 12.8 23.466667 27.733333 25.6 34.133334 0 2.133333 2.133333 4.266667 4.266666 6.4 2.133333 2.133333 4.266667 6.4 4.266667 10.666666 0 2.133333 2.133333 6.4 4.266667 10.666667 4.266667 8.533333 4.266667 8.533333-19.2 10.666667-10.666667 0-23.466667 2.133333-27.733334 2.133333-2.133333 0-6.4 2.133333-8.533333 2.133333 0 0-4.266667-4.266667-6.4-10.666666-6.4-12.8-19.2-25.6-29.866667-36.266667-17.066667-14.933333-34.133333-23.466667-59.733333-29.866667-12.8-8.533333-17.066667-8.533333-32-8.533333-12.8 0-21.333333 0-27.733333 2.133333-4.266667 2.133333-10.666667 2.133333-12.8 4.266667-17.066667 4.266667-38.4 17.066667-53.333334 29.866667-14.933333 14.933333-25.6 27.733333-32 42.666666-4.266667 6.4-12.8 29.866667-10.666666 32 0 0 6.4 4.266667 12.8 6.4 14.933333 4.266667 27.733333 12.8 40.533333 21.333334 12.8 8.533333 34.133333 27.733333 36.266667 29.866666 4.266667 4.266667 10.666667 8.533333 14.933333 12.8 6.4 6.4 12.8 10.666667 12.8 12.8 0 0-6.4 8.533333-14.933333 17.066667-19.2 17.066667-23.466667 21.333333-25.6 21.333333 0 0-4.266667-4.266667-10.666667-6.4-4.266667-4.266667-10.666667-10.666667-14.933333-12.8-4.266667-2.133333-10.666667-8.533333-14.933334-12.8-23.466667-21.333333-49.066667-34.133333-72.533333-34.133333-19.2 0-44.8 8.533333-57.6 21.333333-12.8 10.666667-25.6 29.866667-29.866667 46.933334-2.133333 10.666667-2.133333 34.133333 0 44.8 8.533333 34.133333 36.266667 57.6 70.4 64 10.666667 2.133333 21.333333 2.133333 32 2.133333h21.333334l10.666666-10.666667 23.466667-23.466666c40.533333-38.4 81.066667-76.8 119.466667-115.2 19.2-19.2 51.2-49.066667 68.266666-61.866667 8.533333-6.4 23.466667-14.933333 32-17.066667 4.266667-2.133333 8.533333-4.266667 12.8-4.266666 10.666667-4.266667 25.6-6.4 49.066667-4.266667 8.533333 0 14.933333 0 23.466667 2.133333 6.4 2.133333 29.866667 10.666667 32 10.666667 2.133333 2.133333 4.266667 2.133333 6.4 2.133333 6.4 2.133333 14.933333 8.533333 27.733333 19.2 12.8 10.666667 19.2 17.066667 23.466667 25.6 2.133333 2.133333 4.266667 6.4 6.4 8.533334 2.133333 2.133333 12.8 23.466667 12.8 25.6 0 2.133333 0 4.266667 2.133333 6.4 4.266667 6.4 8.533333 36.266667 8.533333 46.933333-2.133333 40.533333-23.466667 83.2-55.466666 110.933333z" fill="currentColor"></path></svg>',
  oss: '<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M952.74 225.925c26.747 152.33 26.747 416.86 0 572.283-18.524 110.131-42.179 135.864-154.327 155.423-154.327 24.699-414.628 26.757-572.048-1.035-111.114-19.558-134.778-42.199-154.327-154.388-27.78-153.364-27.78-415.826 0-572.283 19.549-110.131 42.179-134.83 154.327-154.388 153.293-27.792 416.687-26.768 572.048 1.024C909.527 92.119 933.192 114.77 952.74 225.925z m-584.397-54.548c-49.387 0-90.542 40.14-90.542 89.548 0 50.432 41.155 90.573 90.542 90.573 16.466 0 31.898-4.116 45.271-12.35 94.659-54.548 102.881-56.606 198.574 1.035 13.374 7.209 28.805 12.35 45.271 12.35 49.388 0 89.508-40.141 89.508-90.573 0-49.408-39.096-90.573-89.508-90.573-16.466 0-31.897 5.15-45.27 12.35-97.742 55.582-100.824 55.582-198.575 0-13.373-8.244-28.805-12.36-45.271-12.36z m433.152 431.267c49.388 0 89.508-40.14 89.508-90.572 0-49.408-40.12-89.55-89.508-89.55-16.466 0-31.898 4.117-45.271 11.326-95.683 54.549-132.72 46.316-211.948 13.384l-12.349-4.116c-6.175-2.059-12.35-3.093-19.548-3.093-5.14 0-11.315 1.034-18.524 2.058l-12.35 5.151c-84.367 32.942-115.23 42.199-212.971-14.408-13.374-7.209-28.805-11.325-44.237-11.325-50.412 0-90.542 40.14-90.542 89.549 0 50.432 40.13 90.572 89.508 90.572 16.466 0 31.897-4.116 45.27-12.349 90.543-52.49 138.896-48.374 157.42-31.908 7.199 4.117 1.024 10.291-14.407 29.85-23.665 27.791-73.053 67.932-117.29 109.107-18.524 17.5-27.78 39.117-27.78 64.84 0 50.432 40.13 90.572 89.507 90.572 11.316 0 22.63-2.058 33.956-5.15 86.426-23.675 156.385-64.84 201.657-86.457 12.349-7.209 5.14 3.093 17.49 32.932 8.232 22.64 34.98 56.607 74.076 59.7 59.678 6.174 92.6-45.292 79.226-93.666-16.465-58.665-76.134-100.874-138.895-76.165-66.877 27.791-126.546 41.175-192.4 41.175-12.349-1.034-11.314-5.15-8.232-12.35 8.233-29.849 58.644-115.281 117.289-144.097 59.678-27.791 110.09-38.082 215.03 22.641 13.393 7.199 28.825 12.35 46.315 12.35z" fill="currentColor"></path></svg>',
  qiniu: '<svg viewBox="0 0 1532 1024" xmlns="http://www.w3.org/2000/svg"><path d="M0.303407 0h28.065186c15.094519 3.792593 29.354667 10.998519 39.215407 23.286519 86.243556 100.200296 194.484148 181.134222 314.481778 236.430222-5.840593-50.669037-12.743111-101.262222-18.280297-152.007111 33.754074-3.489185 70.618074 12.667259 82.223408 46.497185 15.701333 48.165926 26.851556 97.697185 41.111704 146.318222 173.624889 54.46163 363.254519 57.268148 537.941333 5.840593 169.832296-49.379556 324.342519-149.276444 439.789037-283.230815 9.784889-12.212148 23.969185-19.342222 38.987852-23.134815h27.989333c-49.910519 147.683556-149.655704 276.631704-272.914963 371.067259-199.793778 154.055111-472.860444 204.344889-715.207111 135.243852 28.292741 101.869037 56.357926 203.813926 85.257482 305.531259 5.461333 31.706074 27.45837 62.881185 61.819259 65.384297 58.102519 1.972148 116.356741 0.075852 174.459259 0.910222 28.368593 1.744593 59.088593-13.50163 69.025185-41.263408 18.583704-55.978667 28.444444-114.915556 50.744889-169.680592 27.685926-63.563852 96.104296-104.296296 165.281185-98.531556-11.757037 98.910815-23.286519 197.82163-35.877926 296.580741-11.301926 78.051556-71.149037 154.282667-154.510222 158.757926H611.51763c-92.690963-5.082074-152.917333-96.331852-157.847704-182.423704-15.701333-129.554963-31.706074-259.034074-47.786667-388.513185C220.122074 360.978963 68.114963 196.835556 0.303407 0z" fill="currentColor"></path></svg>',
  upyun: '<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M819.733081 102.739233a479.288216 479.288216 0 0 0-59.60814-38.284903 33.923332 33.923332 0 0 0-43.131093 8.723143L589.054425 242.309513l-7.269285 13.084713a70.269759 70.269759 0 0 1-59.123521 27.623285h-25.20019a228.255561 228.255561 0 0 0-213.71699 239.886417 25.200189 25.200189 0 0 0 14.538571 21.807856 60.092759 60.092759 0 1 1-82.385234 71.723616v-3.876952a60.577378 60.577378 0 0 1 11.630856-48.461903 36.831046 36.831046 0 0 0 7.753905-26.654046 279.140558 279.140558 0 0 1 276.717463-303.37151 51.854236 51.854236 0 0 0 41.192617-20.838618l117.762423-156.531945a21.323237 21.323237 0 0 0-11.630856-33.923332A511.75769 511.75769 0 0 0 263.39044 959.54567a33.923332 33.923332 0 0 0 43.615712-9.207762L436.399432 780.721249l8.723143-12.115475a70.754378 70.754378 0 0 1 59.123521-27.623285 218.56318 218.56318 0 0 0 25.200189 0 230.194037 230.194037 0 0 0 168.162802-90.623757 225.832466 225.832466 0 0 0 45.554188-149.26266 25.200189 25.200189 0 0 0-14.538571-21.807856 60.092759 60.092759 0 0 1-35.861808-43.131093 60.092759 60.092759 0 0 1 117.277804-27.138666 14.053952 14.053952 0 0 0 0 4.361571 61.061997 61.061997 0 0 1-11.630856 48.461903 36.831046 36.831046 0 0 0-7.753905 26.654046 279.140558 279.140558 0 0 1-276.717463 303.37151 51.854236 51.854236 0 0 0-41.192617 20.838618L355.952674 969.23805a21.807856 21.807856 0 0 0 11.146238 33.923332 512.24231 512.24231 0 0 0 452.634169-900.422149z" fill="currentColor"></path></svg>',
};

// 获取状态图标
const getStatusIcon = (status: ConnectionStatus): string => {
  switch (status) {
    case 'connected':
      return 'pi-check-circle';
    case 'connecting':
      return 'pi-spin pi-spinner';
    case 'error':
      return 'pi-exclamation-circle';
    case 'unconfigured':
      return 'pi-minus-circle';
    default:
      return 'pi-circle';
  }
};

// 获取状态颜色类
const getStatusClass = (status: ConnectionStatus): string => {
  switch (status) {
    case 'connected':
      return 'status-connected';
    case 'connecting':
      return 'status-connecting';
    case 'error':
      return 'status-error';
    case 'unconfigured':
      return 'status-unconfigured';
    default:
      return 'status-disconnected';
  }
};

// 获取服务 SVG 图标
const getServiceSvg = (serviceId: string): string | null => {
  return serviceIcons[serviceId] || null;
};
</script>

<template>
  <nav class="service-nav">
    <div class="nav-section-title">存储服务</div>
    <div class="service-list">
      <button
        v-for="service in services"
        :key="service.serviceId"
        class="service-item"
        :class="{
          active: service.serviceId === activeService,
          [getStatusClass(service.status)]: true,
        }"
        @click="emit('change', service.serviceId)"
        :title="service.error || service.serviceName"
      >
        <span class="service-icon-svg" v-html="getServiceSvg(service.serviceId)"></span>
        <span class="service-name">{{ service.serviceName }}</span>
        <i :class="`pi ${getStatusIcon(service.status)}`" class="status-indicator"></i>
      </button>
    </div>
  </nav>
</template>

<style scoped>
/* 侧边栏导航 */
.service-nav {
  display: flex;
  flex-direction: column;
  flex: 1;
  overflow-y: auto;
  padding: 0 8px 16px;
}

.nav-section-title {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-muted);
  padding: 8px 12px 12px;
}

.service-list {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.service-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 12px;
  border: none;
  border-radius: 8px;
  background: transparent;
  color: var(--text-secondary);
  font-size: 13px;
  cursor: pointer;
  transition: all 0.15s ease;
  text-align: left;
  width: 100%;
}

.service-item:hover {
  background: var(--hover-overlay);
  color: var(--text-primary);
}

.service-item.active {
  background: var(--selected-bg);
  color: var(--primary);
}

.service-icon-svg {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-muted);
}

.service-icon-svg :deep(svg) {
  width: 100%;
  height: 100%;
}

.service-item:hover .service-icon-svg {
  color: var(--text-primary);
}

.service-item.active .service-icon-svg {
  color: var(--primary);
}

.service-name {
  flex: 1;
  font-weight: 500;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.status-indicator {
  font-size: 10px;
  flex-shrink: 0;
}

/* 状态颜色 */
.service-item.status-connected .status-indicator {
  color: var(--success);
}

.service-item.status-connecting .status-indicator {
  color: var(--warning);
}

.service-item.status-error .status-indicator {
  color: var(--error);
}

.service-item.status-unconfigured .status-indicator {
  color: var(--text-muted);
}

.service-item.status-disconnected .status-indicator {
  color: var(--text-muted);
}

/* 滚动条样式 */
.service-nav::-webkit-scrollbar {
  width: 4px;
}

.service-nav::-webkit-scrollbar-track {
  background: transparent;
}

.service-nav::-webkit-scrollbar-thumb {
  background: var(--scrollbar-thumb);
  border-radius: 2px;
}

.service-nav::-webkit-scrollbar-thumb:hover {
  background: var(--scrollbar-thumb-hover);
}
</style>
