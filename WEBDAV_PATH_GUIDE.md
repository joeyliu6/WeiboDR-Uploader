# WebDAV 远程路径配置指南

## 📝 远程路径格式说明

WebDAV 的"远程路径"是指您希望在 WebDAV 服务器上存储历史记录文件的完整路径。

### 基本格式

```
/目录名/子目录名/文件名.扩展名
```

**重要规则**：
- ✅ 必须以斜杠 `/` 开头
- ✅ 路径中的目录必须已存在（应用不会自动创建）
- ✅ 文件会自动创建，文件名会添加时间戳
- ✅ 扩展名通常使用 `.json`

---

## 📂 常见 WebDAV 服务配置示例

### 1. 坚果云（推荐）

#### 配置示例
| 字段 | 值 |
|------|------|
| **WebDAV URL** | `https://dav.jianguoyun.com/dav/` |
| **用户名** | 您的坚果云账号邮箱 |
| **密码** | 应用密码（非登录密码） |
| **远程路径** | `/WeiboDR/history.json` |

#### 说明
- 在坚果云网页版中，先创建名为 `WeiboDR` 的文件夹
- 每次上传后，应用会自动创建类似 `history_20251118_143025.json` 的文件
- URL 末尾的 `/dav/` 不要忘记

#### 如何获取应用密码
1. 登录坚果云网页版
2. 点击右上角头像 → **账户信息**
3. 在左侧菜单选择 **安全选项**
4. 找到"第三方应用管理"，点击 **添加应用密码**
5. 输入应用名称（如：WeiboDR），生成密码并复制

---

### 2. Yandex.Disk

#### 配置示例
| 字段 | 值 |
|------|------|
| **WebDAV URL** | `https://webdav.yandex.com/` |
| **用户名** | 您的 Yandex 账号 |
| **密码** | 应用专用密码 |
| **远程路径** | `/WeiboDR/history.json` |

#### 说明
- 需要先在 Yandex.Disk 中创建 `WeiboDR` 文件夹
- 推荐使用应用专用密码而非主密码

---

### 3. 自建 WebDAV 服务器（如 Nextcloud）

#### 配置示例
| 字段 | 值 |
|------|------|
| **WebDAV URL** | `https://your-domain.com/remote.php/dav/files/username/` |
| **用户名** | 您的 Nextcloud 用户名 |
| **密码** | 您的 Nextcloud 密码或应用密码 |
| **远程路径** | `/WeiboDR/history.json` |

#### 说明
- URL 中的 `username` 需要替换为您的实际用户名
- 建议使用应用密码而非主密码

---

## 🔍 路径示例详解

### 示例 1：根目录存储（不推荐）

```
/history.json
```

- ✅ 文件会保存在 WebDAV 根目录
- ❌ 不便于管理，推荐使用子目录

### 示例 2：单层目录（推荐）

```
/WeiboDR/history.json
```

- ✅ 文件保存在 `WeiboDR` 目录下
- ✅ 便于管理和查找
- ⚠️ 需要先在 WebDAV 中创建 `WeiboDR` 文件夹

### 示例 3：多层目录

```
/Backups/WeiboDR/history.json
```

- ✅ 文件保存在 `Backups/WeiboDR` 目录下
- ⚠️ 需要先创建 `Backups` 和 `WeiboDR` 两个文件夹

### 示例 4：带日期的目录

```
/WeiboDR/2025/history.json
```

- ✅ 按年份分类存储
- ⚠️ 需要手动创建年份文件夹（应用不会自动创建）

---

## 📦 文件命名规则

应用会自动在您配置的文件名后添加时间戳，避免覆盖现有文件。

### 配置的路径
```
/WeiboDR/history.json
```

### 实际生成的文件
```
/WeiboDR/history_20251118_143025.json
/WeiboDR/history_20251118_150312.json
/WeiboDR/history_20251118_162145.json
...
```

### 时间戳格式
```
YYYYMMDD_HHMMSS
- YYYY: 年份（4位）
- MM: 月份（2位，01-12）
- DD: 日期（2位，01-31）
- HH: 小时（2位，00-23）
- MM: 分钟（2位，00-59）
- SS: 秒数（2位，00-59）
```

---

## ✅ 配置前的准备工作

### 步骤 1：在 WebDAV 服务中创建目录

以坚果云为例：
1. 登录坚果云网页版
2. 在根目录或任意位置创建一个新文件夹，命名为 `WeiboDR`
3. 记录下完整路径（如 `/WeiboDR/`）

### 步骤 2：获取 WebDAV URL

- **坚果云**：`https://dav.jianguoyun.com/dav/`
- **Yandex**：`https://webdav.yandex.com/`
- **自建服务**：参考服务器文档

### 步骤 3：获取认证信息

- 用户名：通常是邮箱或用户名
- 密码：强烈建议使用**应用专用密码**而非主密码

### 步骤 4：填写远程路径

```
/WeiboDR/history.json
```

---

## 🔧 测试连接

配置完成后：
1. 在应用设置页面点击 **"测试 WebDAV 连接"** 按钮
2. 如果显示"✓ WebDAV 连接成功！"，说明配置正确
3. 上传一张图片测试自动同步功能

---

## ⚠️ 常见错误及解决方法

### 错误 1：路径不存在 (HTTP 404)

**原因**：配置的目录在 WebDAV 服务器上不存在

**解决方法**：
1. 登录 WebDAV 服务（如坚果云）
2. 手动创建相应的文件夹
3. 确保路径完全匹配（区分大小写）

### 错误 2：认证失败 (HTTP 401/403)

**原因**：用户名或密码错误

**解决方法**：
1. 检查用户名是否正确
2. 确认使用的是**应用密码**而非登录密码
3. 重新生成应用密码并更新配置

### 错误 3：存储空间不足 (HTTP 507)

**原因**：WebDAV 服务器空间已满

**解决方法**：
1. 清理 WebDAV 服务器上的旧文件
2. 升级服务套餐获取更多空间

### 错误 4：网络连接失败

**原因**：无法连接到 WebDAV 服务器

**解决方法**：
1. 检查网络连接
2. 确认 WebDAV URL 是否正确
3. 检查防火墙设置

---

## 💡 最佳实践建议

1. **使用应用密码**
   - 不要使用主账号密码
   - 定期更换应用密码

2. **定期清理备份文件**
   - 每次上传都会创建新文件
   - 建议定期删除旧的备份文件节省空间

3. **目录结构规划**
   ```
   /WeiboDR/
   ├── history_20251118_143025.json
   ├── history_20251118_150312.json
   └── ...
   ```

4. **备份重要文件**
   - 虽然 WebDAV 提供了远程备份
   - 仍建议定期下载重要的历史记录文件

5. **监控同步日志**
   - 在应用控制台查看同步日志
   - 确认每次上传后都有同步成功的提示

---

## 📚 相关文档

- [R2 配置指南](./R2_SETUP_GUIDE.md)
- [设置界面用户指南](./SETTINGS_V2_USER_GUIDE.md)

---

## 🆘 需要帮助？

如果遇到其他问题，请：
1. 查看应用控制台的错误日志
2. 确认 WebDAV 服务商的文档
3. 提交 Issue 到项目仓库

