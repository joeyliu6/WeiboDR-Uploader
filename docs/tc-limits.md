# 公共图床上传限制

本文档记录项目中各公共图床（除 R2 外）的上传限制，包括文件大小、支持格式和特殊限制。

## 目录

- [限制汇总表](#限制汇总表)
- [京东图床](#京东图床)
- [TCL 图床](#tcl-图床)
- [微博图床](#微博图床)
- [知乎图床](#知乎图床)
- [纳米图床](#纳米图床)
- [牛客图床](#牛客图床)
- [七鱼图床](#七鱼图床)

---

## 限制汇总表

| 图床 | 文件大小 | 支持格式 | 认证要求 | 特殊限制 |
|------|---------|---------|---------|---------|
| **京东** | 15 MB | JPG、PNG、GIF | 无 | 限流重试(2次) |
| **TCL** | 未定义 | JPG、PNG、GIF、HEIC、MP4、MOV | 无 | 限流重试(2次) |
| **微博** | 未定义 | 未明确限制 | Cookie | - |
| **知乎** | 未定义 | JPG、PNG、GIF、WebP | Cookie | 超时重试(3次)、秒传 |
| **纳米** | 未定义 | JPG、PNG、GIF、WebP、BMP | Cookie + Auth-Token | 秒传 |
| **牛客** | 未定义 | JPG、PNG、GIF | Cookie | - |
| **七鱼** | 未定义 | JPG、PNG、GIF、WebP | 自动获取 | 需 Chrome/Edge |

---

## 京东图床

### 文件限制

- **最大文件大小**：15 MB
- **支持格式**：JPG、JPEG、PNG、GIF

### 特殊机制

- **限流处理**：遇到 500 错误或 "forbidden" 错误时触发熔断
- **重试策略**：等待 5-10 秒后重试，最多重试 2 次

### 代码位置

[jd.rs:32-140](../src-tauri/src/commands/jd.rs#L32-L140)

```rust
const MAX_FILE_SIZE: u64 = 15 * 1024 * 1024; // 15 MB
```

---

## TCL 图床

### 文件限制

- **最大文件大小**：暂无明确限制（代码注释："暂不验证文件大小限制，因为限制还不确定"）
- **支持格式**：JPG、JPEG、PNG、GIF、HEIC、MP4、MOV（支持视频）

### 特殊机制

- **限流处理**：检测"操作太频繁"错误
- **重试策略**：遇到限流等待 5 秒后重试，最多重试 2 次

### 代码位置

[tcl.rs:88-90](../src-tauri/src/commands/tcl.rs#L88-L90)

---

## 微博图床

### 文件限制

- **最大文件大小**：未在代码中明确定义
- **支持格式**：未明确限制

### 认证要求

- 需要 Cookie 认证

### 特殊机制

- 返回结果包括图片宽高信息

### 代码位置

- [upload.rs](../src-tauri/src/commands/upload.rs)
- [WeiboUploader.ts](../src/uploaders/weibo/WeiboUploader.ts)

---

## 知乎图床

### 文件限制

- **最大文件大小**：未在代码中明确定义
- **支持格式**：JPG、JPEG、PNG、GIF、WebP

### 认证要求

- 需要 Cookie 认证

### 特殊机制

- **秒传检测**：使用 MD5 Hash 检测重复文件
- **超时处理**：上传超时（30 秒）会触发重试
- **重试策略**：图片处理超时自动重试，最多重试 3 次（间隔 2-6 秒）

### 代码位置

[zhihu.rs:26-28、191](../src-tauri/src/commands/zhihu.rs#L26-L28)

---

## 纳米图床

### 文件限制

- **最大文件大小**：未在代码中明确定义
- **支持格式**：JPG、JPEG、PNG、GIF、WebP、BMP

### 认证要求

- 需要 Cookie 和 Auth-Token 认证

### 特殊机制

- **秒传检测**：使用 SHA1 Hash 检测重复文件
- **分片上传**：支持分片上传（单分片）
- **存储后端**：使用火山引擎 TOS 对象存储

### 代码位置

[nami.rs:64-72](../src-tauri/src/commands/nami.rs#L64-L72)

---

## 牛客图床

### 文件限制

- **最大文件大小**：未在代码中明确定义
- **支持格式**：JPG、JPEG、PNG、GIF

### 认证要求

- 需要 Cookie 认证

### 特殊机制

- 自动移除压缩路径，返回原图链接
- 将 HTTP 自动转换为 HTTPS

### 代码位置

[nowcoder.rs:123-125](../src-tauri/src/commands/nowcoder.rs#L123-L125)

---

## 七鱼图床

### 文件限制

- **最大文件大小**：未在代码中明确定义
- **支持格式**：JPG、JPEG、PNG、GIF、WebP

### 认证要求

- 无需手动认证（Token 由后端自动获取）
- 需要系统安装 Chrome 或 Edge 浏览器

### 特殊机制

- 上传超时时间：45 秒

### 代码位置

[qiyu.rs:72-78](../src-tauri/src/commands/qiyu.rs#L72-L78)

---

## 更新日志

- 2025-12-23: 初始版本，记录所有公共图床的上传限制
